<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="./css/main.css">
    <link rel="stylesheet" href="./css/06_product_home_page.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <script src="https://kit.fontawesome.com/e72344855b.js" crossorigin="anonymous"></script>
</head>

<body>
<nav class="header">
    <div class="d-flex">
        <a class="iconBorder" href="./01_home_page.html"><img class="icon" src="./images/icon.png"></a>
        <div class="search-container">
            <div class="search-bar">
                <input type="text" class="search-input" placeholder="Search...">
                <div class="search-icon">
                    <i class="fas fa-search"></i>
                </div>
            </div>
            <div class="popular-categories">
                <ul>
                    <li>洗衣精</li>
                    <li>花盆</li>
                    <li>衛生紙</li>
                    <li>吹風機</li>
                    <li>剪刀</li>
                    <li>手機殼</li>
                    <li>梳子</li>
                    <li>桌墊</li>
                    <li>馬克杯</li>
                    <li>聖誕樹</li>
                    <li>聖誕裝飾品</li>
                    <li>鉛筆盒</li>
                    <li>耳機</li>
                    <li>繪本</li>
                </ul>
            </div>
        </div>
        <div class="header_link">
            <ul>
                <li>
                    <svg width="1.1vw" height="1.1vw" viewBox="0 0 22 20" fill="none"
                         xmlns="http://www.w3.org/2000/svg">
                        <path
                                d="M8.94965 9.24365L1.60819 15.6852C0.797271 16.3967 0.797271 17.5503 1.60819 18.2618C2.41909 18.9733 3.73385 18.9733 4.54476 18.2618L11.8862 11.8203"
                                stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path
                                d="M16.3651 12.1523L20.3917 15.6853C21.2027 16.3968 21.2027 17.5505 20.3917 18.2619C19.5809 18.9735 18.2661 18.9735 17.4552 18.2619L11.0093 12.6063"
                                stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path
                                d="M5.50522 4.95963L3.30278 5.60379L1.10034 2.38304L2.56863 1.09473L6.23937 3.02718L5.50522 4.95963ZM5.50522 4.95963L8.44367 7.53788"
                                stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path
                                d="M8.94955 9.2435C8.07349 7.28218 8.24477 4.70872 10.0508 3.12408C11.8568 1.53943 15.1898 1.19163 17.0252 2.15785L13.8682 4.9278L13.5748 7.76186L16.8048 7.50441L19.9617 4.73445C21.063 6.34483 20.6666 9.26929 18.8606 10.8539C17.0545 12.4385 14.1215 12.5889 11.8862 11.8201"
                                stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    </i><a href="./11_basic_information.html"
                           class=" link-underline link-underline-opacity-0 text-secondary"> 賣場管理</a>
                </li>
                <li>
                    <svg xmlns="http://www.w3.org/2000/svg" width="1.1vw" height="1.1vw   " viewBox="0 0 20 22"
                         fill="none">
                        <path d="M1 21V19.75C1 14.9175 4.91751 11 9.75 11C14.5825 11 18.5 14.9175 18.5 19.75V21"
                              stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path
                                d="M9.75 11C12.5114 11 14.75 8.76138 14.75 6C14.75 3.23857 12.5114 1 9.75 1C6.98857 1 4.75 3.23857 4.75 6C4.75 8.76138 6.98857 11 9.75 11Z"
                                stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    </i><a href="./03_member.html" class=" link-underline link-underline-opacity-0 text-secondary ">
                    會員中心</a>
                </li>
                <li>
                    <svg xmlns="http://www.w3.org/2000/svg" width="1.1vw" height="1.1vw" viewBox="0 0 17 20"
                         fill="none">
                        <path
                                d="M13.5 9.86888H15.25C15.6642 9.86888 16 10.1635 16 10.5269V17.985C16 18.3484 15.6642 18.643 15.25 18.643H1.75C1.33579 18.643 1 18.3484 1 17.985V10.5269C1 10.1635 1.33579 9.86888 1.75 9.86888H3.5M13.5 9.86888V5.48181C13.5 4.01945 12.5 1.09473 8.5 1.09473C4.5 1.09473 3.5 4.01945 3.5 5.48181V9.86888M13.5 9.86888H3.5"
                                stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <a href="./02-1_login.html" class=" link-underline link-underline-opacity-0 text-secondary">
                        註冊/登入</a>
                </li>
            </ul>
        </div>
        <div class="cart_container">
            <a href="./08_shopping_cart.html">
                <svg xmlns="http://www.w3.org/2000/svg" width="2.7vw" height="2.7vw" viewBox="0 0 40 32"
                     fill="none">
                    <path
                            d="M39.1404 6.20728C38.947 5.97764 38.6949 5.79109 38.4043 5.66266C38.1136 5.53422 37.7927 5.4675 37.4673 5.46788L12.6088 5.48008L12.3246 4.26477C11.7939 1.79221 9.3536 -0.00140304 6.5207 8.23529e-07L2.0818 0.0021945C0.93 0.00272095 -0.00059971 0.821964 2.89972e-07 1.83082C0.00070029 2.83967 0.9323 3.65804 2.0842 3.65751L6.523 3.65532C7.352 3.65488 8.071 4.19554 8.2382 4.96854L8.869 7.67502C8.869 7.67862 8.8732 7.68046 8.8732 7.68414V7.69327L11.7886 19.5716C11.8884 19.9803 12.145 20.3466 12.5156 20.6092C12.8862 20.8718 13.3482 21.0149 13.8246 21.0145L30.7927 21.0061C33.4257 21.0049 35.4557 19.5545 36.2102 17.1727L39.46 7.82822C39.6534 7.27431 39.5322 6.67301 39.1403 6.20719L39.1404 6.20728ZM16.6801 23.7546C14.3826 23.7558 12.5151 25.3961 12.5165 27.412C12.5178 29.4279 14.3872 31.0664 16.6848 31.0653C18.9823 31.0641 20.8498 29.4238 20.8485 27.4079C20.8472 25.392 18.9777 23.7535 16.6801 23.7546ZM30.2196 23.748C27.9221 23.7491 26.0546 25.3894 26.056 27.4054C26.0573 29.4212 27.9267 31.0598 30.2243 31.0586C32.5218 31.0575 34.3893 29.4172 34.388 27.4013C34.3867 25.3854 32.5172 23.7468 30.2196 23.748Z"
                            fill="white"/>
                </svg>
            </a>
        </div>
    </div>
</nav>
<br>
<br>
<main>
    <section>
        <div class="d-flex">
            <p class="p">熱門賣家</p>
            <a href="">查看更多</a>
        </div>
        <div class="d-flex popularSeller">
            <div class=" ">
                <img src="https://down-tw.img.susercontent.com/file/cd7307704a9694eb48a9ade262682b0a" alt="">
                <span>韓版慵懶風圓領寬鬆毛衣 針織上衣</span>
                <button>造訪賣場</button>
            </div>
            <div class="">
                <img src="https://down-tw.img.susercontent.com/file/d31d642eb8331c38117007a5d3d41608" alt="">
                <span>【梨卡】毛呢外套 毛呢大衣【雙排釦】女裝 外套</span>
                <button>造訪賣場</button>
            </div>
            <div class="">
                <img src="https://down-tw.img.susercontent.com/file/sg-11134201-7rbnc-lnu2ce116tkh94" alt="">
                <span>韓版黑色棋盤格毛衣帥氣顯瘦寬鬆針織衫 </span>
                <button>造訪賣場</button>
            </div>
            <div class="">
                <img src="https://down-tw.img.susercontent.com/file/sg-11134201-22120-j8qo4hi5iglv47" alt="">
                <span>正韓簡約翻領素色中長版羊毛大衣</span>
                <button>造訪賣場</button>
            </div>
            <div class="">
                <img src="https://down-tw.img.susercontent.com/file/5efd5c1648eb04f66f22fd6b87484fee" alt="">
                <span>現貨 杏M 長大衣 外套 開衫 風衣 長版衣 大衣</span>
                <button>造訪賣場</button>
            </div>
        </div>
    </section>
    <section>

        <div class="result">
            <div class=" dropdown selector">
                <span>搜尋結果:<span id="searchResult"></span></span>
                <a href="#" id="orderBysoldQuantity" class="selector-item">最熱銷</a>
                <a href="#" id="orderByRating" class="selector-item">評價</a>
                <a href="#" id="orderByPrice" class="selector-item">價格</a>
            </div>
        </div>
        <div class="container-fluid">
            <div class="row similar">

                <!--                <div class="col-3">-->
                <!--                    <a href="">-->
                <!--                        <div class="product-card">-->
                <!--                            <img class="product-image" src="https://via.placeholder.com/200" alt="Product Image">-->
                <!--                            <div class="product-info">-->
                <!--                                <div>-->
                <!--                                    <div class="product-name">商品名稱很長很長的商品名稱可能會跑好幾行</div>-->
                <!--                                    <div class="product-price">$ 100.00</div>-->
                <!--                                </div>-->
                <!--                                <div class="product-rating-sold">-->
                <!--                                    <div class="product-rating">-->
                <!--                                        <span class="star">&#9733;</span>-->
                <!--                                        <span class="star">&#9733;</span>-->
                <!--                                        <span class="star">&#9733;</span>-->
                <!--                                        <span class="star">&#9734;</span>-->
                <!--                                        <span class="star">&#9734;</span>-->
                <!--                                    </div>-->
                <!--                                    <div class="product-sold">已售出: 100 件</div>-->
                <!--                                </div>-->
                <!--                            </div>-->
                <!--                        </div>-->
                <!--                    </a>-->
                <!--                </div>-->

                <!-- ... (repeat for other cards) ... -->

            </div>
        </div>
    </section>
</main>
<footer>
    <div class="footer">
        <div>
            <ul class="footerList">
                <li class="h3">關於我們</li>
                <li>關於DealDove</li>
                <li>加入我們</li>
                <li>賣家中心</li>
                <li>限時特賣</li>
                <li>聯絡媒體</li>
            </ul>
        </div>
        <div>
            <ul class="footerList">
                <li class="h3">客服中心</li>
                <li>幫助中心</li>
                <li>退貨退款</li>
                <li>聯絡客服</li>
            </ul>
        </div>
        <div>
            <ul class="footerList">
                <li class="h3">關注我們</li>
                <li>關於DealDove</li>
                <li>加入我們</li>
                <li><img src="./images/icon _facebook.png"><span> </span><img
                        src="./images/icon _instagram.png"></li>
            </ul>
        </div>
        <div>
            <ul class="footerList">
                <li class="h3">法律與隱私</li>
                <li>隱私權政策</li>
                <li>DealDove條款</li>
            </ul>
        </div>
        <img class="qrcode" src="./images/qrCode.png">
    </div>
</footer>
<!--<script src="./js/06_product_home_page.js"></script>-->
<!--        <script src="./js/productHome.js"></script>-->
</body>
<script>
    let url = new URL(window.location.href);
    let keyword = url.searchParams.get('keyword');

    // 默認是按照熱銷量降序排序
    let orderBy = 'soldQuantity';
    let orderDirection = 'desc';

    // 從 localStorage 中取得資料
    let products = JSON.parse(localStorage.getItem('products')) || [];

    // 根據排序方式和方向排序
    sortProducts(products, orderBy, orderDirection);

    // 渲染排序後的產品
    renderProducts(products);

    // 綁定排序按鈕的點擊事件
    let orderBySoldQuantity = document.getElementById('orderBysoldQuantity');
    let orderByRating = document.getElementById('orderByRating');
    let orderByPrice = document.getElementById('orderByPrice');

    orderBySoldQuantity.addEventListener('click', function () {
        updateSort('soldQuantity');
        renderProducts(products);
    });

    orderByRating.addEventListener('click', function () {
        updateSort('rating');
        renderProducts(products);
    });

    orderByPrice.addEventListener('click', function () {
        updateSort('price');
        renderProducts(products);
    });

    function updateSort(newOrderBy) {

        // 判斷是否同一個排序欄位
        if (orderBy === newOrderBy) {
            // 如果是同一個排序欄位，切換排序方向
            orderDirection = orderDirection === 'asc' ? 'desc' : 'asc';
        } else {
            // 如果是不同的排序欄位，默認升序排序
            orderDirection = 'asc';
        }

        // 更新排序欄位和方向到 localStorage
        localStorage.setItem('orderBy', newOrderBy);
        localStorage.setItem('orderDirection', orderDirection);

        orderBy = newOrderBy;

        // 根據排序方式和方向排序
        sortProducts(products, newOrderBy, orderDirection);

        // 渲染排序後的產品
        renderProducts(products);
        console.log('orderBy:', orderBy)
        console.log('orderDirection:', orderDirection)
    }

    function sortProducts(products, orderBy, orderDirection) {
        products.sort((a, b) => {
            let comparison = 0;
            switch (orderBy) {
                case 'soldQuantity':
                    comparison = b.soldQuantity - a.soldQuantity;
                    break;
                case 'rating':
                    comparison = b.avgRating - a.avgRating;
                    break;
                case 'price':
                    comparison = a.minPrice - b.minPrice;
                    break;
                default:
                    comparison = 0;
                    break;
            }

            return orderDirection === 'desc' ? -comparison : comparison;
        });
    }


    const searchResult = document.getElementById('searchResult')
    searchResult.innerText = keyword;
    if (keyword) {
        fetch(`/keyWordProduct?keyword=${keyword}`)
            .then(response => response.json())
            .then(data => {
                console.log(data)
                //本地儲存Product資料方便後續使用
                localStorage.setItem('products', JSON.stringify(data));
                renderProducts(data);
            })
    } else {
        fetch("/getProduct")
            .then(res => res.json())
            .then(data => {
                //本地儲存Product資料方便後續使用
                localStorage.setItem('products', JSON.stringify(data));
                renderProducts(data);
            })
            .catch(err => {
                console.error("Fetch error:", err);
            });
    }
    let search = document.querySelector('.search-input')
    let searchIcon = document.querySelector('.search-icon')


    searchIcon.addEventListener('click', () => {
        let keyword = search.value
        fetch(`/keyWordProduct?keyword=${keyword}`)
            .then(response => response.json())
            .then(data => {
                searchResult.innerText = keyword;
                //本地儲存Product資料方便後續使用
                localStorage.setItem('products', JSON.stringify(data));
                console.log(data + "from here")
                renderProducts(data);
            })
    })

    search.addEventListener('keyup', (e) => {
        if (e.keyCode === 13) {
            let keyword = search.value
            window.location.href = `./06_product_home_page.html?keyword=${keyword}`
        }
    })

    // 生成星星
    function generateStarRating(avgRating) {
        const maxRating = 5;
        const ratingPercentage = (avgRating / maxRating) * 100;

        const starContainer = document.createElement('div');
        starContainer.classList.add('product-rating');

        for (let i = 1; i <= maxRating; i++) {
            const star = document.createElement('span');
            star.classList.add('star');

            if (i <= (ratingPercentage / 20)) {
                star.innerHTML = '&#9733;';
            } else {
                star.innerHTML = '&#9734;';
            }

            starContainer.appendChild(star);
        }

        return starContainer;
    }

    // 渲染產品
    function renderProducts(products) {
        const similar = document.querySelector('.similar');
        similar.innerHTML = '';
        products.forEach(product => {
            const productCard = createProductCard(product);
            similar.appendChild(productCard);
        });
    }

    // 生成產品卡片
    function createProductCard(product) {
        let productCard = document.createElement('div')
        productCard.classList.add('col-3')
        productCard.innerHTML = `
            <a href="./04_product_page.html?productID=${product.productID}">
                <div class="product-card">
                <img class="product-image" src="${product.coverImageURL}" alt="Product Image">
                <div class="product-info">
                    <div>
                        <div class="product-name">${product.productName}</div>
                        <div class="product-price">$ ${product.minPrice} ~ ${product.maxPrice}</div>
                    </div>
                    <div class="product-rating-sold">
                        <div class="product-rating">
                            ${generateStarRating(product.avgRating).outerHTML}
                        </div>
                        <div class="product-sold">已售出: ${product.soldQuantity} 件</div>
                    </div>
                </div>
            </div>
            </a>
            `
        return productCard
    }

</script>
</html>