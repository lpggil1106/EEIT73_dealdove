<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./css/main.css">
    <link rel="stylesheet" href="./css/08_shopping_cart.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <script src="https://kit.fontawesome.com/e72344855b.js" crossorigin="anonymous"></script>
    <script src="./js/isLogin.js" type="module"></script>
    <title>Checkout Page</title>

</head>
<body>
<nav class="header">
    <div class="d-flex">
        <a class="iconBorder" href=""><img class="icon" src="./images/icon.png"></a>
        <div class="search-container">
            <div class="search-bar">
                <input type="text" class="search-input" placeholder="Search...">
                <div class="search-icon">
                    <i class="fas fa-search"></i>
                </div>
            </div>
            <div class="popular-categories">
                <ul>
                    <li>洗衣精</li>
                    <li>花盆</li>
                    <li>衛生紙</li>
                    <li>吹風機</li>
                    <li>剪刀</li>
                    <li>手機殼</li>
                    <li>梳子</li>
                    <li>桌墊</li>
                    <li>馬克杯</li>
                    <li>聖誕樹</li>
                    <li>聖誕裝飾品</li>
                    <li>鉛筆盒</li>
                    <li>耳機</li>
                    <li>繪本</li>
                </ul>
            </div>
        </div>
        <div class="header_link">
            <ul>
                <li>
                    <svg width="1.1vw" height="1.1vw" viewBox="0 0 22 20" fill="none"
                         xmlns="http://www.w3.org/2000/svg">
                        <path d="M8.94965 9.24365L1.60819 15.6852C0.797271 16.3967 0.797271 17.5503 1.60819 18.2618C2.41909 18.9733 3.73385 18.9733 4.54476 18.2618L11.8862 11.8203"
                              stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M16.3651 12.1523L20.3917 15.6853C21.2027 16.3968 21.2027 17.5505 20.3917 18.2619C19.5809 18.9735 18.2661 18.9735 17.4552 18.2619L11.0093 12.6063"
                              stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M5.50522 4.95963L3.30278 5.60379L1.10034 2.38304L2.56863 1.09473L6.23937 3.02718L5.50522 4.95963ZM5.50522 4.95963L8.44367 7.53788"
                              stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M8.94955 9.2435C8.07349 7.28218 8.24477 4.70872 10.0508 3.12408C11.8568 1.53943 15.1898 1.19163 17.0252 2.15785L13.8682 4.9278L13.5748 7.76186L16.8048 7.50441L19.9617 4.73445C21.063 6.34483 20.6666 9.26929 18.8606 10.8539C17.0545 12.4385 14.1215 12.5889 11.8862 11.8201"
                              stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    </i><a href="" class=" link-underline link-underline-opacity-0 text-secondary"> 賣場管理</a>
                </li>
                <li>
                    <svg xmlns="http://www.w3.org/2000/svg" width="1.1vw" height="1.1vw   " viewBox="0 0 20 22"
                         fill="none">
                        <path d="M1 21V19.75C1 14.9175 4.91751 11 9.75 11C14.5825 11 18.5 14.9175 18.5 19.75V21"
                              stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M9.75 11C12.5114 11 14.75 8.76138 14.75 6C14.75 3.23857 12.5114 1 9.75 1C6.98857 1 4.75 3.23857 4.75 6C4.75 8.76138 6.98857 11 9.75 11Z"
                              stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    </i><a href="" class=" link-underline link-underline-opacity-0 text-secondary"> 會員中心</a>
                </li>
                <li>
                    <svg xmlns="http://www.w3.org/2000/svg" width="1.1vw" height="1.1vw" viewBox="0 0 17 20"
                         fill="none">
                        <path d="M13.5 9.86888H15.25C15.6642 9.86888 16 10.1635 16 10.5269V17.985C16 18.3484 15.6642 18.643 15.25 18.643H1.75C1.33579 18.643 1 18.3484 1 17.985V10.5269C1 10.1635 1.33579 9.86888 1.75 9.86888H3.5M13.5 9.86888V5.48181C13.5 4.01945 12.5 1.09473 8.5 1.09473C4.5 1.09473 3.5 4.01945 3.5 5.48181V9.86888M13.5 9.86888H3.5"
                              stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <a href="/Login" id="login" class=" link-underline link-underline-opacity-0 text-secondary"> 註冊/登入</a>
                </li>
            </ul>
        </div>
        <div class="cart_container">
            <svg xmlns="http://www.w3.org/2000/svg" width="2.7vw" height="2.7vw" viewBox="0 0 40 32" fill="none">
                <path d="M39.1404 6.20728C38.947 5.97764 38.6949 5.79109 38.4043 5.66266C38.1136 5.53422 37.7927 5.4675 37.4673 5.46788L12.6088 5.48008L12.3246 4.26477C11.7939 1.79221 9.3536 -0.00140304 6.5207 8.23529e-07L2.0818 0.0021945C0.93 0.00272095 -0.00059971 0.821964 2.89972e-07 1.83082C0.00070029 2.83967 0.9323 3.65804 2.0842 3.65751L6.523 3.65532C7.352 3.65488 8.071 4.19554 8.2382 4.96854L8.869 7.67502C8.869 7.67862 8.8732 7.68046 8.8732 7.68414V7.69327L11.7886 19.5716C11.8884 19.9803 12.145 20.3466 12.5156 20.6092C12.8862 20.8718 13.3482 21.0149 13.8246 21.0145L30.7927 21.0061C33.4257 21.0049 35.4557 19.5545 36.2102 17.1727L39.46 7.82822C39.6534 7.27431 39.5322 6.67301 39.1403 6.20719L39.1404 6.20728ZM16.6801 23.7546C14.3826 23.7558 12.5151 25.3961 12.5165 27.412C12.5178 29.4279 14.3872 31.0664 16.6848 31.0653C18.9823 31.0641 20.8498 29.4238 20.8485 27.4079C20.8472 25.392 18.9777 23.7535 16.6801 23.7546ZM30.2196 23.748C27.9221 23.7491 26.0546 25.3894 26.056 27.4054C26.0573 29.4212 27.9267 31.0598 30.2243 31.0586C32.5218 31.0575 34.3893 29.4172 34.388 27.4013C34.3867 25.3854 32.5172 23.7468 30.2196 23.748Z"
                      fill="white"/>
            </svg>
        </div>
    </div>
</nav>
<h1 class="text-center mt-4 mb-0" style="font-size:3vw">結帳</h1>
<hr class="custom-hr">
<hr class="my-2 text-center mx-auto mb-0 " style=" boarder-color:red;width:83vw">
<div class="checkout-container">
    <div class="container">
        <div class="cart-item-head">
            <div class="item-info">
                <p>商品資訊</p>
            </div>
            <div class="item-name">
                <p></p>
            </div>
            <div class="item-model">
                <p>商品規格</p>
            </div>
            <div class="item-unit-head">
                <p>商品單價</p>
            </div>
            <div class="item-quantity-head">
                <p>下單數量</p>
            </div>
            <div class="item-total-head">
                <p>價格總價</p>
            </div>
        </div>
        <div class="cart-item">
            <img id="productImg1" src="https://down-tw.img.susercontent.com/file/tw-11134207-7qukz-lg3gbyeti5gq16" alt="Product Image">
            <div class="item-name">
                <P id="productName1">男士休閒襯衫</P>
            </div>
            <div class="item-model">
                <p id="model1">黑,M</p>
            </div>
            <div class="item-unit">
                <p id="price1">900</p>
            </div>
            <div class="item-quantity">
                <p id="quantity1">10</p>
            </div>
            <div class="item-total">
                <p>Total Price</p>
            </div>
        </div>

        <!-- 添加更多商品行 -->
        <div class="cart-item">
            <img src="./images/ball2.png" alt="Product Image">
            <div class="item-name">
                <p>Product Name</p>
            </div>
            <div class="item-model">
                <p>Unit Price</p>
            </div>
            <div class="item-unit">
                <p>222</p>
            </div>
            <div class="item-quantity">
                <p>1</p>
            </div>
            <div class="item-total">
                <p>Total Price</p>
            </div>
        </div>


    </div>
</div>

<form>
    <div class="container" style="padding-left:3.5vw">
        <div class="row">
            <div class="col-sm-6">
                <div class="form-group row" style=" height:50px">
                    <label for="name" class="col-sm-3 col-form-label form-p"><p class="text-sm">姓名:</p></label>
                    <div class="col-sm-5">
                        <input type="name" class="form-control" id="name">
                    </div>
                </div>
                <div class="form-group row" style=" height:50px">
                    <label for="email" class="col-sm-3 col-form-label form-p"><p class="">電話:</p></label>
                    <div class="col-sm-5">
                        <input type="email" class="form-control" id="email">
                    </div>
                </div>
                <div class="form-group row" style=" height:50px">
                    <label for="email" class="col-sm-3 col-form-label form-p"><p class="text-sm">收件門市:</p>
                    </label>
                    <div class="col-sm-5">
                        <input type="email" class="form-control" id="deliever">
                    </div>
                </div>

            </div>
            <div class="col-sm-6">
                <div class="form-group row" style="height:50px">
                    <label for="email" class="col-sm-3 col-form-label text-center d-flex align-items-center"><p
                            class="text-sm">買家備註:</p></label>
                    <div class="col-sm-8">
                            <textarea class="form-control" id="buyerNote" placeholder="請輸入買家備註"
                                      rows="5"></textarea>
                    </div>
                </div>
            </div>
        </div>

    </div>
    <div class="container coupon-container">
        <div class="">
            <p class="text-sm">優惠券:</p>
        </div>
    </div>
    <div class="container">
        <div class="container-checkout">
            <div class="payment-options">
                <div class="payment-option" style="padding-top:2px">
                    <p class="text-sm">付款方式:</p>
                </div>
                <div class="payment-options">
                    <button id="payButton" onclick="redirectToPayment()">前往付款</button>
                    <div id="ECPayPayment"></div>
                    <input type="radio" id="ecpayment" name="payment" value="ecpayment">
                    <label for="ecpayment">綠界支付</label>
                    <input type="radio" id="cash" name="payment" value="cash">
                    <label for="cash">貨到付款</label>
                </div>
            </div>

        </div>
        <div id="orderSummary" class="container">
            <div class="summary-item">
                <div class="summary-label">
                    <p>商品數量:</p>
                </div>
                <div class="summary-value">
                    <p id="productQuantity">0</p>
                </div>
            </div>
            <div class="summary-item">
                <p class="summary-label">折扣金額:</p>
                <p id="discountAmount" class="summary-value">$0.00</p>
            </div>
            <div class="summary-item">
                <p class="summary-label">總金額:</p>
                <p id="totalAmount" class="summary-value">$0.00</p>
            </div>

            <button id="submitOrderBtn" class="submit-btn">下訂單</button>
        </div>
    </div>
</form>
</div>
<script>

    // 獲取所有的 .cart-item 元素
    const cartItems = document.querySelectorAll('.cart-item');

    // 計算並更新總價的值
    cartItems.forEach(item => {
        const unitElement = item.querySelector('.item-unit p');
        const quantityElement = item.querySelector('.item-quantity p');

        const totalElement = item.querySelector('.item-total p');

        const unitPrice = parseFloat(unitElement.textContent);
        const quantity = parseInt(quantityElement.textContent);

        const totalPrice = unitPrice * quantity;
        totalElement.textContent = totalPrice.toString(); // 更新 .item-total 的內容
    });

    // 假的購物車結果資料，請在這邊實現entity購物車連結
    const cartData = [
        { quantity: 10, discount: 10, total: 90 }
    ];

    // 更新訂單摘要
    document.addEventListener('DOMContentLoaded', function() {
        updateOrderSummary(); // 调用函数以更新订单摘要
    });
    function updateOrderSummary() {
        const cartItems = document.querySelectorAll('.container .cart-item'); // 获取所有购物车项目
        const productQuantityElement = document.getElementById('productQuantity');
        const discountAmountElement = document.getElementById('discountAmount');
        const totalAmountElement = document.getElementById('totalAmount');


        let totalQuantity = 0;
        let totalAmount = 0;
        let discountAmount = 0;

        cartItems.forEach(item => {
            const quantityElement = item.querySelector('.item-quantity p');
            const unitPriceElement = item.querySelector('.item-unit p');
            const totalElement = item.querySelector('.item-total p');

            const quantity = parseInt(quantityElement.textContent, 10);
            const unitPrice = parseFloat(unitPriceElement.textContent);
            const totalPrice = quantity * unitPrice;



            totalQuantity += quantity; // 累加商品数量
            totalAmount += totalPrice; // 累加商品总价

            totalElement.textContent = totalPrice.toFixed(2); // 更新该项目的总价
        });

        // 更新顯示
        productQuantityElement.textContent = totalQuantity;
        discountAmountElement.textContent = `$${discountAmount.toFixed(2)}`;
        totalAmountElement.textContent = `$${(totalAmount - discountAmount).toFixed(2)}`;
    }
    // function updateOrderSummary() {
    //     const productQuantityElement = document.getElementById('productQuantity');
    //     const discountAmountElement = document.getElementById('discountAmount');
    //     const totalAmountElement = document.getElementById('totalAmount');
    //
    //     // 計算總商品數量、折扣金額、總金額
    //     const productQuantity = cartData.reduce((sum, item) => sum + item.quantity, 0);
    //     const discountAmount = cartData.reduce((sum, item) => sum + item.discount, 0);
    //     const totalAmount = cartData.reduce((sum, item) => sum + item.total, 0);
    //
    //     // 更新顯示
    //     productQuantityElement.textContent = productQuantity;
    //     discountAmountElement.textContent = `$${discountAmount.toFixed(2)}`;
    //     totalAmountElement.textContent = `$${totalAmount.toFixed(2)}`;
    // }
</script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // 假设您已经有了 userID
        const userID = '4uIXMQan5kRprMeKC1QXLrIzw2D2'; // 您需要根据实际情况获取这个值

        fetchModelInfo(userID);
    });
    function fetchModelInfo(userID) {
        // 使用固定的 userId 构建请求 URL
        const url = `/09_checkoutPage/shoppingCart/${userID}/modelInfo`;

        fetch(url)
            .then(response => {
                if(response.ok) {
                    return response.json();
                }
                throw new Error('Failed to fetch model info');
            })
            .then(data => {
                // 假设返回的数据包含 models 属性
                document.getElementById('model1').textContent = data.models;
                document.getElementById('quantity1').textContent = data.quantity;
            })
            .catch(error => console.error('Error:', error));
    }
    // function fetchModelInfo(userId) {
    //     // 根据您的后端API实际地址进行更改
    //     fetch(`/09_checkoutPage/shoppingCart/${userId}/modelInfo`)
    //         .then(response => {
    //             if(response.ok) {
    //                 return response.json();
    //             }
    //             throw new Error('Models not found');
    //         })
    //         .then(data => {
    //             // 更新页面上的元素
    //             document.getElementById('model1').textContent = data.models;
    //         })
    //         .catch(error => console.error('Error fetching model info:', error));
    // }
</script>
<script src="https://ecpg-stage.ecpay.com.tw/Scripts/sdk-1.0.0.js?t=20210121100116"></script>
<script>
    function redirectToPayment() {
        fetch('/ecpayCheckout', {
            method: 'POST'
        }).then(res => res.text())
            .then(data => {
                    var div = document.createElement('div');
                    div.innerHTML = data;

                    // 將 div 中的 form 元素添加到 body 中
                    var form = div.querySelector('form');
                    if (form) {
                        document.body.appendChild(form);

                        // 提交表單
                        form.submit();
                    } else {
                        console.error('Form element not found in HTML content.');
                    }
                }
            )
            .catch(error => {
                console.error('Fetch error:', error);
            });

    }



</script>

<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.2/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</body>
</html>